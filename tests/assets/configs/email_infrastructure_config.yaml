# Email Infrastructure Configuration
# Comprehensive email server setup with security policies and proper lifecycle management
# Includes SMTP, POP3, and DNS servers with baseline security configurations

# Email Infrastructure Services Configuration
email_infrastructure:
  # SMTP Server Configuration
  smtp_server:
    service_type: "smtp-server"
    hostname: "mail_server"
    ip_address: "192.168.100.10"
    port: 25
    domain: "demo.company.com"
    
    # Basic Configuration
    max_message_size: 10485760  # 10MB
    max_attachment_size: 5242880  # 5MB
    max_recipients_per_message: 50
    max_connections: 100
    connection_timeout: 300  # 5 minutes
    require_auth: false  # For demonstration purposes
    enable_tls: true
    enable_security_logging: true
    enable_attachment_scanning: true
    
    # Security Policies - Baseline Configuration
    security_policies:
      # Sender-based blocking
      blocked_senders:
        - "phishing@attacker.com"
        - "malware@badactor.net"
        - "spam@suspicious.org"
        - "noreply@phishing-site.com"
        - "*@known-phishing.com"  # Wildcard domain blocking
        - "*@malicious-domain.net"
        - "admin@fake-bank.com"
        - "security@fake-company.org"
      
      # IP-based blocking (CIDR notation supported)
      blocked_ips:
        - "203.0.113.50"      # Single malicious IP
        - "198.51.100.0/24"   # Malicious subnet
        - "192.0.2.0/24"      # Another test malicious subnet
        - "203.0.113.100/30"  # Small malicious range
        - "10.0.0.0/8"        # Block private networks from external
      
      # Content-based filtering
      quarantine_keywords:
        - "urgent wire transfer"
        - "click here immediately"
        - "verify your account"
        - "suspended account"
        - "confirm your identity"
        - "update payment information"
        - "act now or lose access"
        - "congratulations you have won"
        - "nigerian prince"
        - "inheritance claim"
      
      # Subject line patterns (regex supported)
      blocked_subject_patterns:
        - "^RE: Urgent.*"
        - ".*WINNER.*"
        - ".*CONGRATULATIONS.*"
        - ".*INHERITANCE.*"
        - ".*WIRE TRANSFER.*"
      
      # Attachment restrictions
      attachment_restrictions:
        blocked_extensions:
          - ".exe"
          - ".scr"
          - ".bat"
          - ".com"
          - ".pif"
          - ".cmd"
          - ".vbs"
          - ".js"
          - ".jar"
          - ".msi"
        max_size_mb: 5
        scan_for_malware: true
        quarantine_suspicious: true
        allowed_mime_types:
          - "application/pdf"
          - "application/msword"
          - "application/vnd.openxmlformats-officedocument.wordprocessingml.document"
          - "application/vnd.ms-excel"
          - "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
          - "image/jpeg"
          - "image/png"
          - "image/gif"
          - "text/plain"
      
      # Rate limiting
      rate_limiting:
        max_emails_per_hour: 100
        max_emails_per_day: 500
        max_recipients_per_hour: 200
        burst_threshold: 10  # Max emails in 1 minute
      
      # Reputation-based filtering
      reputation_filtering:
        enable_spf_check: true
        enable_dkim_check: true
        enable_dmarc_check: true
        min_reputation_score: 50  # 0-100 scale
        quarantine_low_reputation: true
    
    # Mailbox Configuration
    mailbox_settings:
      default_quota_mb: 1000  # 1GB per user
      max_message_age_days: 365
      auto_cleanup_enabled: true
      backup_enabled: true
      backup_retention_days: 30
    
    # Logging Configuration
    logging:
      log_level: "INFO"
      log_all_connections: true
      log_blocked_attempts: true
      log_security_events: true
      log_attachment_scans: true
      retention_days: 90
      export_format: "json"
    
    # Performance Settings
    performance:
      max_concurrent_connections: 50
      thread_pool_size: 10
      queue_size: 1000
      delivery_retry_attempts: 3
      delivery_retry_interval: 300  # 5 minutes

  # POP3 Server Configuration
  pop3_server:
    service_type: "pop3-server"
    hostname: "mail_server"
    ip_address: "192.168.100.10"
    port: 110
    domain: "demo.company.com"
    
    # Basic Configuration
    max_connections: 50
    connection_timeout: 600  # 10 minutes
    require_auth: false  # For demonstration purposes
    enable_tls: true
    enable_security_logging: true
    
    # Security Settings
    security_settings:
      max_login_attempts: 3
      lockout_duration: 300  # 5 minutes
      session_timeout: 1800  # 30 minutes
      enable_ip_whitelisting: false
      allowed_ip_ranges:
        - "192.168.1.0/24"    # Corporate network
        - "192.168.50.0/24"   # Remote office
    
    # Performance Settings
    performance:
      max_concurrent_sessions: 25
      max_messages_per_session: 1000
      max_download_size_mb: 100
      enable_caching: true
      cache_size_mb: 256
    
    # Logging Configuration
    logging:
      log_level: "INFO"
      log_all_connections: true
      log_authentication_attempts: true
      log_message_retrievals: true
      retention_days: 30

  # DNS Server Configuration
  dns_server:
    service_type: "dns-server"
    hostname: "dns_server"
    ip_address: "192.168.100.20"
    port: 53
    domain: "demo.company.com"
    
    # Basic Configuration
    authoritative: true
    recursive: true
    enable_caching: true
    cache_ttl: 3600  # 1 hour
    max_cache_size_mb: 128
    
    # DNS Records
    dns_records:
      # A Records
      a_records:
        - name: "mail.demo.company.com"
          ip: "192.168.100.10"
          ttl: 3600
        - name: "www.demo.company.com"
          ip: "192.168.100.30"
          ttl: 3600
        - name: "dns.demo.company.com"
          ip: "192.168.100.20"
          ttl: 3600
        - name: "demo.company.com"
          ip: "192.168.100.30"
          ttl: 3600
      
      # MX Records (Mail Exchange)
      mx_records:
        - name: "demo.company.com"
          mail_server: "mail.demo.company.com"
          priority: 10
          ttl: 3600
        - name: "demo.company.com"
          mail_server: "backup-mail.demo.company.com"
          priority: 20
          ttl: 3600
      
      # CNAME Records
      cname_records:
        - name: "smtp.demo.company.com"
          target: "mail.demo.company.com"
          ttl: 3600
        - name: "pop3.demo.company.com"
          target: "mail.demo.company.com"
          ttl: 3600
        - name: "imap.demo.company.com"
          target: "mail.demo.company.com"
          ttl: 3600
      
      # TXT Records (SPF, DKIM, DMARC)
      txt_records:
        - name: "demo.company.com"
          value: "v=spf1 ip4:192.168.100.10 -all"
          ttl: 3600
          description: "SPF record"
        - name: "_dmarc.demo.company.com"
          value: "v=DMARC1; p=quarantine; rua=mailto:dmarc@demo.company.com"
          ttl: 3600
          description: "DMARC policy"
        - name: "selector1._domainkey.demo.company.com"
          value: "v=DKIM1; k=rsa; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC..."
          ttl: 3600
          description: "DKIM public key"
    
    # Security Settings
    security_settings:
      enable_dnssec: true
      block_malicious_domains: true
      blocked_domains:
        - "known-phishing.com"
        - "malicious-domain.net"
        - "fake-bank.com"
        - "fake-company.org"
        - "suspicious.org"
      enable_query_logging: true
      max_queries_per_second: 1000
      enable_rate_limiting: true
    
    # Performance Settings
    performance:
      max_concurrent_queries: 100
      query_timeout: 5  # seconds
      enable_compression: true
      tcp_idle_timeout: 30
      udp_timeout: 5

# User Account Configuration
user_accounts:
  # Corporate Users
  - username: "alice@demo.company.com"
    display_name: "Alice Marketing"
    department: "Marketing"
    role: "Marketing Manager"
    quota_mb: 2000
    enabled: true
    security_level: "standard"
    
  - username: "bob@demo.company.com"
    display_name: "Bob Developer"
    department: "Engineering"
    role: "Senior Developer"
    quota_mb: 1500
    enabled: true
    security_level: "standard"
    
  - username: "charlie@demo.company.com"
    display_name: "Charlie Assistant"
    department: "Administration"
    role: "Executive Assistant"
    quota_mb: 1000
    enabled: true
    security_level: "standard"
    
  - username: "security@demo.company.com"
    display_name: "Security Team"
    department: "IT Security"
    role: "Security Analyst"
    quota_mb: 5000
    enabled: true
    security_level: "admin"
    
  - username: "remote@demo.company.com"
    display_name: "Remote Worker"
    department: "Field Operations"
    role: "Field Worker"
    quota_mb: 500
    enabled: true
    security_level: "limited"

# Security Event Templates
security_event_templates:
  blocked_sender:
    event_type: "email_blocked"
    severity: "medium"
    description: "Email blocked due to sender policy"
    action: "block"
    
  blocked_ip:
    event_type: "connection_blocked"
    severity: "high"
    description: "Connection blocked due to IP policy"
    action: "block"
    
  quarantine:
    event_type: "email_quarantined"
    severity: "medium"
    description: "Email quarantined due to content policy"
    action: "quarantine"
    
  malicious_attachment:
    event_type: "malware_detected"
    severity: "high"
    description: "Malicious attachment detected"
    action: "quarantine"
    
  rate_limit_exceeded:
    event_type: "rate_limit_violation"
    severity: "medium"
    description: "Rate limit exceeded"
    action: "throttle"

# Service Lifecycle Management
service_lifecycle:
  startup_order:
    1: "dns-server"
    2: "smtp-server"
    3: "pop3-server"
  
  shutdown_order:
    1: "pop3-server"
    2: "smtp-server"
    3: "dns-server"
  
  health_checks:
    dns_server:
      check_type: "port"
      port: 53
      interval: 30
      timeout: 5
      
    smtp_server:
      check_type: "smtp"
      port: 25
      interval: 60
      timeout: 10
      test_command: "HELO test"
      
    pop3_server:
      check_type: "port"
      port: 110
      interval: 60
      timeout: 10
  
  restart_policies:
    dns_server:
      max_restarts: 3
      restart_delay: 30
      
    smtp_server:
      max_restarts: 5
      restart_delay: 60
      
    pop3_server:
      max_restarts: 3
      restart_delay: 30

# Monitoring and Alerting
monitoring:
  metrics:
    - name: "emails_sent_per_hour"
      type: "counter"
      description: "Number of emails sent per hour"
      
    - name: "emails_blocked_per_hour"
      type: "counter"
      description: "Number of emails blocked per hour"
      
    - name: "connections_active"
      type: "gauge"
      description: "Number of active connections"
      
    - name: "queue_size"
      type: "gauge"
      description: "Size of email queue"
      
    - name: "disk_usage_percent"
      type: "gauge"
      description: "Disk usage percentage"
  
  alerts:
    - name: "high_block_rate"
      condition: "emails_blocked_per_hour > 50"
      severity: "warning"
      description: "High email block rate detected"
      
    - name: "queue_full"
      condition: "queue_size > 800"
      severity: "critical"
      description: "Email queue nearly full"
      
    - name: "disk_full"
      condition: "disk_usage_percent > 90"
      severity: "critical"
      description: "Disk space critically low"

# Configuration Metadata
metadata:
  version: "1.0"
  description: "Comprehensive email infrastructure configuration for security demonstration"
  created_date: "2025-01-27"
  last_modified: "2025-01-27"
  
  features:
    - "SMTP server with security policies"
    - "POP3 server with authentication"
    - "DNS server with security records"
    - "Comprehensive logging and monitoring"
    - "Attachment scanning and restrictions"
    - "Rate limiting and reputation filtering"
    - "Service lifecycle management"
    - "Security event templates"
  
  security_controls:
    - "Sender and IP blocking"
    - "Content-based filtering"
    - "Attachment restrictions"
    - "Rate limiting"
    - "DNS security"
    - "Comprehensive logging"
    - "Health monitoring"
    - "Automated alerting"